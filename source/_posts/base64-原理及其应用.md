title: base64 原理及其应用
date: 2018-07-25 09:50:08
tags:
---
## 什么是base64？

Base64是一种基于64个可打印字符来表示二进制数据的表示方法。64个可打印字符包括字母A-Z、a-z、数字 0-9 还有 + 和 / 。由于64个字符可以由6 bit(2的六次方)表示完，然而一个字节有8 bit,这样子就会有2 bit浪费，所以8和6的最小公倍数24。这样子，**3个字节刚好可以用4个Base64的可打印字符来表示。**

<!--more-->

## 转码过程
先来两个表格：

[ASCII码对照表](http://tool.oschina.net/commons?type=4)

base64编码表(如下图)

![base64编码表](https://s1.ax1x.com/2018/09/20/im76WF.png)

转码步骤主要有以下几步

1. 每3个8bit为一组进行分组
2. 取每个字符的ASCII码(可从上面给出的链接查找)
3. 将ASCII编码转换成8bit的二进制，得到一组24bit的字节
4. 将这24bit划分为4个6bit的字节，得到4个8bit的字节
5. 将这4个8bit的字节转换成10进制，对照Base64编码表(上图)，得到对应编码后的字符。

注意：

1. 要求被编码字符是8bit的，所以须在ASCII编码范围内，\u0000-\u00ff，中文就不行。
2. 如果被编码字符长度不是3的倍数的时候，不够的用0补全，再用=补满四个字节。(多一个字节，转成2个base64编码符号，补两个等号；多两个字节，转成3个编码符号，补一个等号，这就是为什么有些Base64编码会以一个或两个等号结束的原因)

以 nice 为例进行转换

```
文本                n             i                c               e

ASCII              110           105               99             101

二进制           01101110       01101001         01100011        01100101

二进制(4个6bit/组)   011011      100110      100101       100011      011001   010000(补零)   补两个等号

十进制              27          38         37           35           25           16             =        =


base64编码           b          m           l           j             Z            Q             =         =
``` 
所以base64编码nice出来的结果是bmljZQ==

## Base64 编码应用

### 内嵌Base64编码图片
前端展示页面时，一些简单图片(大尺寸图片不适用)，通常会选择将图片内容直接内嵌在页面中，避免不必要的外部资源加载，增大页面加载时间，图片数据是二进制数据，可以使用Base64对图片或其他文件的二进制数据进行编码，利用 Data URLs的特性,将其作为文本字符串嵌入网页中。同理，音频，视频的数据传输也可以采用这种方式。

Data URLs 格式为：url(data:文件类型;编码方式,编码后的文件内容)

### SMTP协议(电子邮件传输协议)
SMTP协议开始是基于纯ASCII文本的，因为二进制文件可能存任意数据，使得对方难以区分你的数据内容与控制字符。后来新增MIME标准来编码二进制文件，使SMTP协议传输二进制文件变得几乎和纯文本一样。

### URL
有些应用需要把二进制数据放到URL里，URL只能是特定的一些ASCII字符。这时候，也需要用到BASE64编码。当然这也只是对二进制数据本身的编码，编码后的数据里面可能包含+/,真正放到URL里面时候，还需要URL-Encoding,变成%XX模式。
## 注意
Base64是一种数据编码方式，目的是让数据符合传输协议的要求。并不适合用于数据加密或者数据校验。